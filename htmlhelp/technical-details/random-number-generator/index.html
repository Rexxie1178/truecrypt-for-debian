<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Random Number Generator - Truecrypt</title>
<link rel='stylesheet' id='wp-block-library-group-css' href='../../wp-content/plugins/bwp-minify/cache/minify-b1-wp-block-library-b4bc22b6e85c5b4ad13ac5538241afe6592e.css?ver=3' type='text/css' media='all'>
</head>
<body class="page-template">
<div class="container">
<div class="row">
<div class="col-sm-8 blog-main-right">
<div class="blog-post">
<h2 class="blog-post-title">Random Number Generator</h2>
<p class="blog-post-meta"><br></p>
<div class="entry clearfix">
<p class="s12">The TrueCrypt random number generator (RNG) is used to generate the master encryption key, the secondary key (XTS mode), salt, and keyfiles. It creates a pool of random values in RAM (memory). The pool, which is 320 bytes long, is filled with data from the following sources:</p>
<ul>
<li>Mouse movements</li>
<li>Keystrokes</li>
<li><i>Mac OS X and Linux</i>: Values generated by the built-in RNG (both <i>/dev/random</i> and<i>/dev/urandom</i>)</li>
<li><i>MS Windows only</i>: MS Windows CryptoAPI (collected regularly at 500-ms interval)</li>
<li><i>MS Windows only</i>: Network interface statistics (NETAPI32)</li>
<li><i>MS Windows only</i>: Various Win32 handles, time variables, and counters (collected regularly at 500-ms interval)</li>
</ul>
<p class="s12">Before a value obtained from any of the above-mentioned sources is written to the pool, it is divided into individual bytes (e.g., a 32-bit number is divided into four bytes). These bytes are then individually written to the pool with the modulo 2<span class="s49">8</span> addition operation (not by replacing the old values in the pool) at the position of the pool cursor. After a byte is written, the pool cursor position is advanced by one byte. When the cursor reaches the end of the pool, its position is set to the beginning of the pool. After every 16<span class="s49">th</span> byte written to the pool, the pool mixing function is automatically applied to the entire pool (see below).</p>
<h3>Pool Mixing Function</h3>
<p class="s12">The purpose of this function is to perform diffusion [2]. Diffusion spreads the influence of individual “raw” input bits over as much of the pool state as possible, which also hides statistical relationships. After every 16<span class="s49">th</span> byte written to the pool, this function is applied to the entire pool.</p>
<p class="s12">Description of the pool mixing function:</p>
<ol>
<li>Let <i>R</i> be the randomness pool.</li>
<li>Let <i>H</i> be the hash function selected by the user (SHA-512, RIPEMD-160, or Whirlpool).</li>
<li><i>l</i> = byte size of the output of the hash function <i>H</i> (i.e., if <i>H</i> is RIPEMD-160, then <i>l</i> = 20; if <i>H</i> is SHA-512, <i>l</i> = 64)</li>
<li><i>z</i> = byte size of the randomness pool <i>R</i> (320 bytes)</li>
<li><i>q</i> = <i>z</i> / <i>l</i> – 1 (e.g., if <i>H</i> is Whirlpool, then <i>q</i> = 4)</li>
<li>R <span class="s12">is divided into</span> l<span class="s12">-byte blocks</span> B<span class="sub">0</span><span class="s12">…</span>B<span class="s47">q</span>.
<p class="s46"><span class="s12">For 0</span> <span class="s48">≤</span> i <span class="s48">≤</span> q <span class="s12">(i.e., for each block</span> B<span class="s12">) the following steps are performed:</span></p>
<ol type="a">
<li><i>M = H</i> (<i>B</i><span class="sub">0</span> || <i>B</i><span class="sub">1</span> || … || <i>B</i><span class="s47">q</span>) <span class="s53">[i.e., the randomness pool is hashed using the hash function</span> <span class="s32">H</span><span class="s53">, which produces a hash</span><span class="s32">M</span><span class="s53">]</span></li>
<li>B<span class="s47">i</span> = B<span class="s47">i</span> ^ M</li>
</ol>
</li>
<li><i>R = B</i><span class="sub">0</span> || <i>B</i><span class="sub">1</span> || … || <i>B</i><span class="s47">q</span></li>
</ol>
<p>For example, if <i>q</i> = 1, the randomness pool would be mixed as follows:</p>
<ol>
<li>(<i>B</i><span class="sub">0</span> || <i>B</i><span class="sub">1</span>) = <i>R</i></li>
<li><i>B</i><span class="sub">0</span> = <i>B</i><span class="sub">0</span> ^ <i>H</i>(<i>B</i><span class="sub">0</span> || <i>B</i><span class="sub">1</span>)</li>
<li><i>B</i><span class="sub">1</span> = <i>B</i><span class="sub">1</span> ^ <i>H</i>(<i>B</i><span class="sub">0</span> || <i>B</i><span class="sub">1</span>)</li>
<li><i>R</i> = <i>B</i><span class="sub">0</span> || <i>B</i><span class="sub">1</span></li>
</ol>
<h3>Generated Values</h3>
<p class="s12">The content of the RNG pool is never directly exported (even when TrueCrypt instructs the RNG to generate and export a value). Thus, even if the attacker obtains a value generated by the RNG, it is infeasible for him to determine or predict (using the obtained value) any other values generated by the RNG during the session (it is infeasible to determine the content of the pool from a value generated by the RNG).</p>
<p class="s12">The RNG ensures this by performing the following steps whenever TrueCrypt instructs it to generate and export a value:</p>
<ol>
<li>Data obtained from the sources listed above is added to the pool as described above.</li>
<li>The requested number of bytes is copied from the pool to the output buffer (the copying starts from the position of the pool cursor; when the end of the pool is reached, the copying continues from the beginning of the pool; if the requested number of bytes is greater than the size of the pool, no value is generated and an error is returned).</li>
<li>The state of each bit in the pool is inverted (i.e., 0 is changed to 1, and 1 is changed to 0).</li>
<li>Data obtained from some of the sources listed above is added to the pool as described above.</li>
<li>The content of the pool is transformed using the pool mixing function. Note: The function uses a cryptographically secure one-way hash function selected by the user (for more information, see the section <i>Pool Mixing Function</i> above).</li>
<li>The transformed content of the pool is XORed into the output buffer as follows:
<ol type="a">
<li>The output buffer write cursor is set to 0 (the first byte of the buffer).</li>
<li>The byte at the position of the pool cursor is read from the pool and XORed into the byte in the output buffer at the position of the output buffer write cursor.</li>
<li>The pool cursor position is advanced by one byte. If the end of the pool is reached, the cursor position is set to 0 (the first byte of the pool).</li>
<li>The position of the output buffer write cursor is advanced by one byte.</li>
<li>Steps b–d are repeated for each remaining byte of the output buffer (whose length is equal to the requested number of bytes).</li>
<li>The content of the output buffer, which is the final value generated by the RNG, is exported.</li>
</ol>
</li>
</ol>
<h3>Design Origins</h3>
<p class="s12">The design and implementation of the random number generator are based on the following works:</p>
<ul>
<li>Software Generation of Practically Strong Random Numbers <span class="s12">by Peter Gutmann [10]</span></li>
<li>Cryptographic Random Numbers <span class="s12">by Carl Ellison [11]</span></li>
</ul>
</div>
</div>
</div>
<div class="col-sm-3 col-sm-offset-1 blog-sidebar-left">
<div id="search-4" class="sidebar-module widget widget_search"><br>
<br>
<br></div>
<div id="nav_menu-2" class="sidebar-module widget widget_nav_menu">
<div class="menu-documentation-container">
<ul id="menu-documentation" class="menu">
<li class="menu-item"><a href="../../index.html"><strong>Introduction</strong></a></li>
<li class="menu-item"><a href="../../beginners-tutorial/index.html"><strong>Beginner’s Tutorial</strong></a></li>
<li class="menu-item"><a href="../../system-encryption/index.html"><strong>System Encryption</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../system-encryption/operating-systems-supported-for-system-encryption/index.html">Supported Systems</a></li>
<li class="menu-item"><a href="../../system-encryption/hidden-operating-system/index.html">Hidden Operating System</a></li>
<li class="menu-item"><a href="../../system-encryption/truecrypt-rescue-disk/index.html">TrueCrypt Rescue Disk</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../plausible-deniability/index.html"><strong>Plausible Deniability</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../plausible-deniability/hidden-volume/index.html">Hidden Volume</a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../plausible-deniability/hidden-volume/protection-of-hidden-volumes-against-damage/index.html">Hidden Volume Protection</a></li>
<li class="menu-item"><a href="../../plausible-deniability/hidden-volume/security-requirements-and-precautions-pertaining-to-hidden-volumes/index.html">Security Requirements</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../plausible-deniability/hidden-operating-system/index.html">Hidden Operating System</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../parallelization/index.html"><strong>Parallelization</strong></a></li>
<li class="menu-item"><a href="../../pipelining/index.html"><strong>Pipelining</strong></a></li>
<li class="menu-item"><a href="../../hardware-acceleration/index.html"><strong>Hardware Acceleration</strong></a></li>
<li class="menu-item"><a href="../../encryption-algorithms/index.html"><strong>Encryption Algorithms</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../encryption-algorithms/aes/index.html">AES</a></li>
<li class="menu-item"><a href="../../encryption-algorithms/serpent/index.html">Serpent</a></li>
<li class="menu-item"><a href="../../encryption-algorithms/twofish/index.html">Twofish</a></li>
<li class="menu-item"><a href="../../encryption-algorithms/cascades/index.html">Cascades</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../hash-algorithms/index.html"><strong>Hash Algorithms</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../hash-algorithms/ripemd-160/index.html">RIPEMD-160</a></li>
<li class="menu-item"><a href="../../hash-algorithms/sha-512/index.html">SHA-512</a></li>
<li class="menu-item"><a href="../../hash-algorithms/whirlpool/index.html">Whirlpool</a></li>
</ul>
</li>
<li class="menu-item"><a href="../index.html"><strong>Technical Details</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../notation/index.html">Notation</a></li>
<li class="menu-item"><a href="../encryption-scheme/index.html">Encryption Scheme</a></li>
<li class="menu-item"><a href="../modes-of-operation/index.html">Modes of Operation</a></li>
<li class="menu-item"><a href="../header-key-derivation-salt-and-iteration-count/index.html">Header Key Derivation</a></li>
<li class="menu-item"><a href="index.html">Random Number Generator</a></li>
<li class="menu-item"><a href="../keyfiles/index.html">Keyfiles</a></li>
<li class="menu-item"><a href="../truecrypt-volume-format-specification/index.html">Volume Format Specification</a></li>
<li class="menu-item"><a href="../compliance-with-standards-and-specifications/index.html">Standards and Specifications</a></li>
<li class="menu-item"><a href="../source-code/index.html">Source Code</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../truecrypt-volume/index.html"><strong>TrueCrypt Volume</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../truecrypt-volume/creating-a-new-truecrypt-volume/index.html">Creating a New TrueCrypt Volume</a></li>
<li class="menu-item"><a href="../../truecrypt-volume/favorite-volumes/index.html">Favorite Volumes</a></li>
<li class="menu-item"><a href="../../truecrypt-volume/system-favorite-volumes/index.html">System Favorite Volumes</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../main-program-window/index.html"><strong>Main Program Window</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../main-program-window/program-menu/index.html">Program Menu</a></li>
<li class="menu-item"><a href="../../main-program-window/mounting-truecrypt-volumes/index.html">Mounting TrueCrypt Volumes</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../supported-operating-systems/index.html"><strong>Supported Operating Systems</strong></a></li>
<li class="menu-item"><a href="../../portable-mode/index.html"><strong>Portable Mode</strong></a></li>
<li class="menu-item"><a href="../../keyfiles/index.html"><strong>Keyfiles</strong></a></li>
<li class="menu-item"><a href="../../security-tokens-smart-cards/index.html"><strong>Security Tokens & Smart Cards</strong></a></li>
<li class="menu-item"><a href="../../language-packs/index.html"><strong>Language Packs</strong></a></li>
<li class="menu-item"><a href="../../hot-keys/index.html"><strong>Hot Keys</strong></a></li>
<li class="menu-item"><a href="../../security-model/index.html"><strong>Security Model</strong></a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/index.html"><strong>Security Requirements</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../security-requirements-and-precautions/data-leaks/index.html">Data Leaks</a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../security-requirements-and-precautions/data-leaks/paging-file/index.html">Paging File</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/data-leaks/hibernation-file/index.html">Hibernation File</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/data-leaks/memory-dump-files/index.html">Memory Dump Files</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/unencrypted-data-in-ram/index.html">Unencrypted Data in RAM</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/physical-security/index.html">Physical Security</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/malware/index.html">Malware</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/multi-user-environment/index.html">Multi-User Environment</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/authenticity-and-integrity/index.html">Authenticity and Integrity</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/choosing-passwords-and-keyfiles/index.html">Choosing Passwords and Keyfiles</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/changing-passwords-and-keyfiles/index.html">Changing Passwords and Keyfiles</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/trim-operation/index.html">Trim Operation</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/wear-leveling/index.html">Wear-Leveling</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/reallocated-sectors/index.html">Reallocated Sectors</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/defragmenting/index.html">Defragmenting</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/journaling-file-systems/index.html">Journaling File Systems</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/volume-clones/index.html">Volume Clones</a></li>
<li class="menu-item"><a href="../../security-requirements-and-precautions/additional-security-requirements-and-precautions/index.html">Additional Security Requirements and Precautions</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../command-line-usage/index.html"><strong>Command Line Usage</strong></a></li>
<li class="menu-item"><a href="../../how-to-back-up-securely/index.html"><strong>How to Back Up Securely</strong></a></li>
<li class="menu-item"><a href="../../miscellaneous/index.html"><strong>Miscellaneous</strong></a>
<ul class="sub-menu">
<li class="menu-item"><a href="../../miscellaneous/using-truecrypt-without-administrator-privileges/index.html">Using TrueCrypt Without Administrator Privileges</a></li>
<li class="menu-item"><a href="../../miscellaneous/sharing-over-network/index.html">Sharing over Network</a></li>
<li class="menu-item"><a href="../../miscellaneous/truecrypt-background-task/index.html">TrueCrypt Background Task</a></li>
<li class="menu-item"><a href="../../miscellaneous/volume-mounted-as-removable-medium/index.html">Volume Mounted as Removable Medium</a></li>
<li class="menu-item"><a href="../../miscellaneous/truecrypt-system-files-application-data/index.html">TrueCrypt System Files & Application Data</a></li>
<li class="menu-item"><a href="../../miscellaneous/how-to-remove-encryption/index.html">How to Remove Encryption</a></li>
<li class="menu-item"><a href="../../miscellaneous/uninstalling-truecrypt/index.html">Uninstalling TrueCrypt</a></li>
<li class="menu-item"><a href="../../miscellaneous/digital-signatures/index.html">Digital Signatures</a></li>
</ul>
</li>
<li class="menu-item"><a href="../../troubleshooting/index.html"><strong>Troubleshooting</strong></a></li>
<li class="menu-item"><a href="../../frequently-asked-questions/index.html"><strong>Frequently Asked Questions</strong></a></li>
<li class="menu-item"><a href="../../incompatibilities/index.html"><strong>Incompatibilities</strong></a></li>
<li class="menu-item"><a href="../../known-issues-limitations/index.html"><strong>Known Issues & Limitations</strong></a></li>
<li class="menu-item"><a href="../../legal-information/index.html"><strong>Legal Information</strong></a></li>
<li class="menu-item"><a href="../../future-development/index.html"><strong>Future Development</strong></a></li>
<li class="menu-item"><a href="../../acknowledgements/index.html"><strong>Acknowledgements</strong></a></li>
<li class="menu-item"><a href="../../version-history/index.html"><strong>Version History</strong></a></li>
<li class="menu-item"><a href="../../references/index.html"><strong>References</strong></a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
